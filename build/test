
# sophia test-suite makefile
#

TEST_DEBUG   = -g -O0 -Wall
TEST_CFLAGS  = $(CFLAGS_INCLUDE) $(TEST_DEBUG) -I. -I../sophia -pthread
TEST_LDFLAGS = $(LDFLAGS) $(TEST_DEBUG) ../sophia/libsophia.a -pthread
TEST_LOGDIR  = logdir
TEST_DIR     = dir
TEST_BINARY  = run

all: build
.c.o:
	$(E) "cc   $<"
	$(Q) $(CC) $(TEST_CFLAGS) -c $< -o $@
build: clean $(OBJECTS)
	$(E) "cc   $(TEST_BINARY)"
	$(Q) $(CC) $(OBJECTS) $(TEST_LDFLAGS) -o $(TEST_BINARY)
clean:
	$(Q) $(RM) -f $(TEST_BINARY)
	$(Q) $(RM) -f $(OBJECTS)
cleanup: clean
	$(Q) $(RM) -fr $(TEST_DIR) $(TEST_LOGDIR)
test:
	$(Q) $(VALGRIND) ./$(TEST_BINARY)

.PHONY: test

# vim: syntax=make
